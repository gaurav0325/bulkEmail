<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Email Sender - Data Analysis Insights</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .contact-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        .contact-item:hover {
            background: #f8f9fa;
        }
        .contact-item.selected {
            background: #007bff;
            color: white;
        }
        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        textarea, input[type="text"], input[type="email"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
        }
        textarea {
            min-height: 300px;
            resize: vertical;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📧 Bulk Email Sender</h1>
        <p>Data Analysis Insights - Professional Email Campaign Tool</p>
        <div id="status" class="status ready">✅ System Ready</div>
    </div>

    <div class="main-content">
        <div class="panel">
            <h2>📂 Contacts & Template</h2>

            <button class="button" onclick="loadSampleData()">📋 Load Sample Data</button>

            <h3>Email Template</h3>
            <textarea id="emailTemplate" placeholder="Email template will appear here...">From: vishwas.agarwal@gmail.com
From-Name: Intex Technologies
To: {email}
Subject: Business Partnership Opportunity - Intex Technologies in {country}

Dear Valued Prospective Partner,

We are pleased to introduce Intex Technologies, a globally recognized brand with a rich legacy spanning 29 years in the consumer electronics and technology sectors.

Since our inception in 1996, we have been at the forefront of innovation, designing and manufacturing cutting-edge products that enhance the daily lives of millions of consumers worldwide. Our commitment to excellence has made us a trusted name in markets across the globe.

Our Product Portfolio:
• IT Peripherals: Speakers, keyboards, mice, webcams, and computer accessories
• Home Appliances: Air coolers, room heaters, water purifiers, and kitchen appliances
• Mobile Accessories: Power banks, chargers, cables, and smartphone accessories
• Audio Solutions: Wireless speakers, headphones, and sound systems

We are actively seeking distribution partners in {country} who share our vision of delivering high-quality, innovative products to consumers. We believe {firm}, with its {businessFocus}, would be an ideal partner for expanding our reach in the {country} market.

Given {firm}'s {marketStrength}, we see significant opportunities for collaboration in areas where Intex Technologies can provide value:

{businessOpportunities}

What We Offer Our Partners:
✓ Competitive pricing with attractive profit margins
✓ Comprehensive marketing support and co-branding opportunities
✓ Technical training and ongoing product support
✓ Flexible payment terms and credit facilities
✓ Exclusive territory rights (subject to discussion)
✓ Access to our complete product catalog and new launches

Why Partner with Intex Technologies:
- 29+ years of industry experience and innovation
- Global presence with operations in 40+ countries
- ISO certified manufacturing facilities
- Strong R&D capabilities with continuous product development
- Proven track record of successful partnerships worldwide

We would welcome the opportunity to discuss how we can work together to bring Intex Technologies' innovative products to the {country} market through {firm}. Our team is available to provide detailed product catalogs, pricing structures, and partnership terms that align with your business objectives.

Please feel free to contact us at your earliest convenience to explore this exciting business opportunity. We are confident that a partnership between Intex Technologies and {firm} will be mutually beneficial and contribute to significant growth in the {country} market.

Thank you for your time and consideration. We look forward to hearing from you soon and to the possibility of establishing a long-term, successful business relationship.

Best regards,

Vishwas Agarwal
Business Development Manager
Intex Technologies
Email: vishwas.agarwal@gmail.com
Phone: +91-11-4716-1111
Website: www.intex.in

P.S. We are also interested in exploring private label manufacturing opportunities and joint ventures for established brands in the {country} market. Please let us know if {firm} has any interest in such collaborations.</textarea>

            <h3>Contact List</h3>
            <div id="contactsList">
                <p>Click "Load Sample Data" to see contacts</p>
            </div>
        </div>

        <div class="panel">
            <h2>📨 Email Composer</h2>
            <div id="alerts"></div>

            <div style="margin-bottom: 15px;">
                <label>From:</label>
                <input type="email" id="fromEmail" value="info@datanalysisninsights.co.uk">
            </div>

            <div style="margin-bottom: 15px;">
                <label>To:</label>
                <input type="email" id="toEmail" placeholder="Select a contact first">
            </div>

            <div style="margin-bottom: 15px;">
                <label>Subject:</label>
                <input type="text" id="subject" placeholder="Email subject">
            </div>

            <div style="margin-bottom: 15px;">
                <label>Message:</label>
                <textarea id="messageBody" placeholder="Email content will appear here"></textarea>
            </div>

            <div>
                <button class="button" onclick="sendEmail()" id="sendBtn" disabled>📤 Send Email</button>
                <button class="button" onclick="sendBulkEmails()" id="bulkBtn" disabled style="background: #dc3545;">📬 Send All</button>
                <button class="button" onclick="testConnection()" style="background: #28a745;">🔧 Test SMTP</button>
            </div>

            <div style="margin-top: 20px;">
                <h3>📊 Statistics</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div style="background: #e7f3ff; padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="totalCount">0</div>
                        <div>Total</div>
                    </div>
                    <div style="background: #e7ffe7; padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="sentCount">0</div>
                        <div>Sent</div>
                    </div>
                    <div style="background: #ffe7e7; padding: 10px; border-radius: 5px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: bold;" id="remainingCount">0</div>
                        <div>Remaining</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple global variables - no classes to avoid complexity
        let contacts = [];
        let selectedContactIndex = -1;

        // Sample data with detailed business focus - no API calls needed
        const sampleContacts = [
            {
                email: "john.smith@techsolutions.co.uk",
                contactName: "John Smith",
                firm: "Tech Solutions UK Ltd",
                country: "United Kingdom",
                businessFocus: "IT retail and consumer electronics distribution",
                marketStrength: "Strong presence in UK retail chains and online platforms",
                sent: false,
                success: false
            },
            {
                email: "sarah.jones@innovate.com",
                contactName: "Sarah Jones",
                firm: "Innovate Corp",
                country: "United States",
                businessFocus: "Home appliances and smart technology distribution",
                marketStrength: "Extensive network across major US retail outlets",
                sent: false,
                success: false
            },
            {
                email: "raj.patel@globaltech.in",
                contactName: "Raj Patel",
                firm: "Global Tech Solutions",
                country: "India",
                businessFocus: "Mobile accessories and IT peripherals wholesale",
                marketStrength: "Pan-India distribution network with tier-2 and tier-3 city reach",
                sent: false,
                success: false
            },
            {
                email: "maria.garcia@techmexico.mx",
                contactName: "Maria Garcia",
                firm: "TechMexico Solutions",
                country: "Mexico",
                businessFocus: "Consumer electronics and audio solutions retail",
                marketStrength: "Leading distributor in Mexico and Central America",
                sent: false,
                success: false
            },
            {
                email: "ahmed.hassan@middleeasttech.ae",
                contactName: "Ahmed Hassan",
                firm: "Middle East Tech Hub",
                country: "United Arab Emirates",
                businessFocus: "Premium electronics and home appliances distribution",
                marketStrength: "Strategic location serving GCC and MENA markets",
                sent: false,
                success: false
            },
            {
                email: "chen.li@asiatech.sg",
                contactName: "Chen Li",
                firm: "Asia Tech Distribution",
                country: "Singapore",
                businessFocus: "IT peripherals and business solutions distribution",
                marketStrength: "Hub for Southeast Asian market penetration",
                sent: false,
                success: false
            }
        ];

        function showAlert(message, type = 'success') {
            const alerts = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            alerts.appendChild(alert);

            // Remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        function loadSampleData() {
            contacts = [...sampleContacts];
            renderContacts();
            updateStats();
            document.getElementById('bulkBtn').disabled = false;
            showAlert('Sample contacts loaded successfully!');
        }

        function renderContacts() {
            const container = document.getElementById('contactsList');
            container.innerHTML = '';

            contacts.forEach((contact, index) => {
                const div = document.createElement('div');
                div.className = 'contact-item';
                if (contact.sent) {
                    div.style.background = contact.success ? '#d4edda' : '#f8d7da';
                    div.style.borderLeft = contact.success ? '4px solid #28a745' : '4px solid #dc3545';
                }
                div.onclick = () => selectContact(index);

                const statusIcon = contact.sent ? (contact.success ? '✅' : '❌') : '⏳';

                div.innerHTML = `
                    <strong>${contact.firm}</strong> ${statusIcon}<br>
                    👤 ${contact.contactName}<br>
                    📧 ${contact.email}<br>
                    🌍 ${contact.country}<br>
                    💼 ${contact.businessFocus}<br>
                    📈 ${contact.marketStrength}
                    ${contact.sent ? `<br><small style="font-weight: bold;">${contact.success ? '✅ Sent successfully' : '❌ Failed to send'}</small>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function generateBusinessOpportunities(contact) {
            const opportunities = {
                "United Kingdom": "• Premium IT peripherals for the growing remote work market\n• Smart home appliances aligned with UK energy efficiency standards\n• Audio solutions for the thriving UK gaming and entertainment sector",

                "United States": "• Advanced home automation and smart appliance solutions\n• High-quality audio systems for the premium consumer market\n• Mobile accessories for the competitive US smartphone market",

                "India": "• Affordable mobile accessories for the massive smartphone user base\n• IT peripherals targeting the growing IT services sector\n• Energy-efficient appliances for price-conscious consumers",

                "Mexico": "• Consumer electronics tailored for the Latin American market\n• Audio solutions for Mexico's vibrant entertainment industry\n• Cost-effective home appliances for the expanding middle class",

                "United Arab Emirates": "• Premium electronics for the affluent GCC market\n• Smart home solutions for modern UAE households\n• High-end audio systems for the luxury consumer segment",

                "Singapore": "• IT peripherals for Singapore's tech-savvy business environment\n• Compact home appliances suitable for urban living\n• Professional audio solutions for the creative industries"
            };

            return opportunities[contact.country] || "• Customized product solutions based on local market requirements\n• Premium electronics suited for your market demographics\n• Innovative technology products aligned with regional preferences";
        }

        function selectContact(index) {
            selectedContactIndex = index;
            const contact = contacts[index];

            // Update UI
            document.querySelectorAll('.contact-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });

            // Update email form headers
            document.getElementById('fromEmail').value = 'vishwas.agarwal@gmail.com';
            document.getElementById('toEmail').value = contact.email;
            document.getElementById('subject').value = `Business Partnership Opportunity - Intex Technologies in ${contact.country}`;

            // Generate personalized email body from template
            let template = document.getElementById('emailTemplate').value;

            // Generate business opportunities specific to this contact
            const businessOpportunities = generateBusinessOpportunities(contact);

            let body = template
                .replace(/{email}/g, contact.email)
                .replace(/{contactName}/g, contact.contactName || 'Valued Prospective Partner')
                .replace(/{country}/g, contact.country)
                .replace(/{firm}/g, contact.firm)
                .replace(/{businessFocus}/g, contact.businessFocus || 'established market presence')
                .replace(/{marketStrength}/g, contact.marketStrength || 'strong distribution network')
                .replace(/{businessOpportunities}/g, businessOpportunities);

            // Remove email headers from body for display
            const lines = body.split('\n');
            let bodyStart = 0;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].trim() === '' && i > 0) {
                    bodyStart = i + 1;
                    break;
                }
                if (!lines[i].includes(':') || lines[i].startsWith('Dear')) {
                    bodyStart = i;
                    break;
                }
            }

            document.getElementById('messageBody').value = lines.slice(bodyStart).join('\n').trim();
            document.getElementById('sendBtn').disabled = false;

            showAlert(`Selected: ${contact.contactName} from ${contact.firm} (${contact.country})`);
        }

        async function sendEmail() {
            const fromEmail = document.getElementById('fromEmail').value;
            const toEmail = document.getElementById('toEmail').value;
            const subject = document.getElementById('subject').value;
            const body = document.getElementById('messageBody').value;

            if (!toEmail || !subject || !body) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            try {
                document.getElementById('sendBtn').textContent = '📤 Sending...';
                document.getElementById('sendBtn').disabled = true;

                // Try to send via working function
                const response = await fetch('/.netlify/functions/send-email-working', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        from_email: fromEmail,
                        to_email: toEmail,
                        subject: subject,
                        content: body
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert(`✅ ${result.message}`);

                    // Mark contact as sent if we have a selected contact
                    if (selectedContactIndex >= 0) {
                        contacts[selectedContactIndex].sent = true;
                        contacts[selectedContactIndex].success = true;
                        renderContacts();
                        updateStats();
                    }
                } else {
                    showAlert(`ℹ️ ${result.message}`, 'error');

                    // Show troubleshooting if available
                    if (result.troubleshooting) {
                        result.troubleshooting.forEach(tip => {
                            showAlert(`💡 ${tip}`, 'error');
                        });
                    }

                    if (result.required_vars) {
                        showAlert('Required environment variables:', 'error');
                        result.required_vars.forEach(variable => {
                            showAlert(`• ${variable}`, 'error');
                        });
                    }

                    // Mark contact as failed if we have a selected contact
                    if (selectedContactIndex >= 0) {
                        contacts[selectedContactIndex].sent = true;
                        contacts[selectedContactIndex].success = false;
                        renderContacts();
                        updateStats();
                    }
                }

            } catch (error) {
                showAlert(`Network error: ${error.message}`, 'error');
            } finally {
                document.getElementById('sendBtn').textContent = '📤 Send Email';
                document.getElementById('sendBtn').disabled = false;
            }
        }

        async function testConnection() {
            try {
                showAlert('Testing SMTP connection...', 'success');

                const response = await fetch('/.netlify/functions/health');
                const result = await response.json();

                if (result.status === 'ok') {
                    showAlert('✅ Server connection successful!');
                    document.getElementById('status').textContent = '✅ Server Connected';
                    document.getElementById('status').className = 'status ready';
                } else {
                    throw new Error('Health check failed');
                }
            } catch (error) {
                showAlert('❌ Server connection failed', 'error');
                document.getElementById('status').textContent = '❌ Server Issues';
                document.getElementById('status').className = 'status error';
            }
        }

        async function sendBulkEmails() {
            const unsentContacts = contacts.filter(contact => !contact.sent);

            if (unsentContacts.length === 0) {
                showAlert('All emails have already been sent!', 'error');
                return;
            }

            if (!confirm(`Send emails to ${unsentContacts.length} contacts?\n\nThis will send with a 2-second delay between emails for Zoho rate limiting.`)) {
                return;
            }

            const bulkBtn = document.getElementById('bulkBtn');
            bulkBtn.textContent = '📤 Sending Bulk...';
            bulkBtn.disabled = true;

            let successCount = 0;
            let failCount = 0;

            showAlert(`Starting bulk email to ${unsentContacts.length} contacts...`);

            for (let i = 0; i < unsentContacts.length; i++) {
                const contact = unsentContacts[i];
                const contactIndex = contacts.findIndex(c => c.email === contact.email);

                try {
                    showAlert(`Sending ${i + 1}/${unsentContacts.length}: ${contact.contactName}`);

                    // Generate personalized email content for this contact
                    let template = document.getElementById('emailTemplate').value;
                    const businessOpportunities = generateBusinessOpportunities(contact);

                    let body = template
                        .replace(/{email}/g, contact.email)
                        .replace(/{contactName}/g, contact.contactName || 'Valued Prospective Partner')
                        .replace(/{country}/g, contact.country)
                        .replace(/{firm}/g, contact.firm)
                        .replace(/{businessFocus}/g, contact.businessFocus || 'established market presence')
                        .replace(/{marketStrength}/g, contact.marketStrength || 'strong distribution network')
                        .replace(/{businessOpportunities}/g, businessOpportunities);

                    // Remove email headers from body
                    const lines = body.split('\n');
                    let bodyStart = 0;
                    for (let j = 0; j < lines.length; j++) {
                        if (lines[j].trim() === '' && j > 0) {
                            bodyStart = j + 1;
                            break;
                        }
                        if (!lines[j].includes(':') || lines[j].startsWith('Dear')) {
                            bodyStart = j;
                            break;
                        }
                    }
                    const emailBody = lines.slice(bodyStart).join('\n').trim();

                    // Send email
                    const response = await fetch('/.netlify/functions/send-email-working', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            from_email: 'vishwas.agarwal@gmail.com',
                            from_name: 'Intex Technologies',
                            to_email: contact.email,
                            subject: `Business Partnership Opportunity - Intex Technologies in ${contact.country}`,
                            content: emailBody
                        })
                    });

                    const result = await response.json();

                    // Update contact status
                    contacts[contactIndex].sent = true;
                    contacts[contactIndex].success = result.success;

                    if (result.success) {
                        successCount++;
                        showAlert(`✅ Sent to ${contact.contactName}`, 'success');
                    } else {
                        failCount++;
                        showAlert(`❌ Failed: ${contact.contactName} - ${result.message}`, 'error');
                    }

                    // Update UI
                    renderContacts();
                    updateStats();

                    // Rate limiting: 2-second delay between emails (Zoho recommended)
                    if (i < unsentContacts.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }

                } catch (error) {
                    failCount++;
                    contacts[contactIndex].sent = true;
                    contacts[contactIndex].success = false;
                    showAlert(`❌ Network error for ${contact.contactName}: ${error.message}`, 'error');
                    renderContacts();
                    updateStats();
                }
            }

            // Final summary
            showAlert(`🏁 Bulk email completed! ✅ Sent: ${successCount}, ❌ Failed: ${failCount}`, successCount > 0 ? 'success' : 'error');

            bulkBtn.textContent = '📬 Send All';
            bulkBtn.disabled = false;
        }

        function updateStats() {
            const total = contacts.length;
            const sent = contacts.filter(c => c.sent).length;
            const remaining = total - sent;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('sentCount').textContent = sent;
            document.getElementById('remainingCount').textContent = remaining;
        }

        // Initialize on page load - no complex initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Simple email sender loaded');
            showAlert('Simple Email Sender ready! Click "Load Sample Data" to start.');
        });
    </script>
</body>
</html>